set firewall ipv4 name WAN-LOCAL rule {{ interface.custom_fields.Wireguard_LocalPort }} action 'accept'
set firewall ipv4 name WAN-LOCAL rule {{ interface.custom_fields.Wireguard_LocalPort }} description 'wireguard {{ interface.description }}'
set firewall ipv4 name WAN-LOCAL rule {{ interface.custom_fields.Wireguard_LocalPort }} destination port '{{ interface.custom_fields.Wireguard_PeerPort }}'
set firewall ipv4 name WAN-LOCAL rule {{ interface.custom_fields.Wireguard_LocalPort }} protocol 'udp'
{%- if interface.custom_fields.BGP_PeerGroup.name == 'DN42 Peer' -%}
set firewall zone DN42EXT interface '{{ interface.name }}'
{%- else -%}
set firewall zone DN42EXT interface '{{ interface.name }}'

{% for address in interface.ip_addresses -%}
set interfaces wireguard {{ interface.name }} address '{{ address['address'] }}'
{%-  endfor %}
set interfaces wireguard {{ interface.name }} description '{{ interface.description }}'
set interfaces wireguard {{ interface.name }} peer wg-{{ interface.custom_fields.Wireguard_LocalPort }} address '{{ interface.custom_fields.Wireguard_PeerClearnetIP|replace("/32", "")|replace("/128", "") }}'
set interfaces wireguard {{ interface.name }} peer wg-{{ interface.custom_fields.Wireguard_LocalPort }} allowed-ips '0.0.0.0/0'
set interfaces wireguard {{ interface.name }} peer wg-{{ interface.custom_fields.Wireguard_LocalPort }} allowed-ips '::/0'
set interfaces wireguard {{ interface.name }} peer wg-{{ interface.custom_fields.Wireguard_LocalPort }} port '{{ interface.custom_fields.Wireguard_PeerPort }}'
{% if interface.custom_fields.Wireguard_PresharedKey -%}
set interfaces wireguard {{ interface.name }} peer wg-{{ interface.custom_fields.Wireguard_LocalPort }} preshared-key '{{ interface.custom_fields.Wireguard_PresharedKey }}'
{%- endif %}
set interfaces wireguard {{ interface.name }} peer wg-{{ interface.custom_fields.Wireguard_LocalPort }} public-key '{{ interface.custom_fields.Wireguard_PeerPubkey }}'
set interfaces wireguard {{ interface.name }} port '{{ interface.custom_fields.Wireguard_LocalPort }}'
set interfaces wireguard {{ interface.name }} private-key '{{ interface.custom_fields.Wireguard_Privkey }}'